var redis      = require("redis"),
    client     = redis.createClient(),
    itemsToAdd = new Array ();

client.on("error", function (err) {
	console.log("Error " + err);
});

module.exports.removeFromlist = function (listname, rawArgs, verbose) {
	// taken from http://stackoverflow.com/questions/784012/javascript-equivalent-of-phps-in-array on 20150518 @ 19:50 EST
	var inArray = function (needle, haystack) {
		var length = haystack.length;
		for(var i = 0; i < length; i++) {
			if(haystack[i] == needle) return true;
		}
		return false;
	};

	/*rawArgs.forEach(function (val, index, array) {
		// skip the first two element ['node', 'add-to-list']
		if (index >= 2)
			itemToRemove.push (val);
	});*/

itemToRemove = rawArgs;

	client.get (listname, function (err, reply) {
		if (reply != null) {
			list = JSON.parse(reply.toString());

			if (inArray (itemToRemove, list)) {
				if (verbose) console.log ("removing " + itemToRemove + " from " + listname);

				list.splice (list.indexOf(itemToRemove), 1);
				
				client.set (listname, JSON.stringify (list), function (err, reply) {
					client.quit();
				});

				client.quit();
			} else {
				if (verbose) console.log ("item not found in " + listname);
				client.quit();
			}
		} else {
			console.log ("error");
		}
	});
}